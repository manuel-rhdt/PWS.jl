<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Marginalization Strategies · PathWeightSampling.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PathWeightSampling.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">PathWeightSampling.jl</a></li><li><a class="tocitem" href="../guide/">Guide</a></li><li><a class="tocitem" href="../systems/">Systems</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li class="is-active"><a class="tocitem" href>Marginalization Strategies</a><ul class="internal"><li><a class="tocitem" href="#Equivalence-of-Marginalization-Integrals-and-Free-Energy-Computations"><span>Equivalence of Marginalization Integrals and Free Energy Computations</span></a></li><li><a class="tocitem" href="#Direct-PWS"><span>Direct PWS</span></a></li><li><a class="tocitem" href="#RR-PWS"><span>RR-PWS</span></a></li><li><a class="tocitem" href="#TI-PWS"><span>TI-PWS</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Marginalization Strategies</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Marginalization Strategies</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/manuel-rhdt/PathWeightSampling.jl/blob/master/docs/src/marginalization.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Marginalization-Strategies"><a class="docs-heading-anchor" href="#Marginalization-Strategies">Marginalization Strategies</a><a id="Marginalization-Strategies-1"></a><a class="docs-heading-anchor-permalink" href="#Marginalization-Strategies" title="Permalink"></a></h1><p>The computationally most demanding part of PWS is the evaluation of the marginalization integral <span>$\mathcal{P}[\bm{x}]=\int\mathcal{D}[\bm{s}] \mathcal{P}[\bm{s},\bm{x}]$</span> which needs to be computed repeatedly for many different outputs <span>$\bm{x}_1,\ldots,\bm{x}_N$</span>. Consequently the computational efficiency of the marginalization is essential for the overall simulation performance.</p><p>Marginalization is a general term to denote an operation where one or more variables are integrated out of a joint probability distribution, say <span>$\mathcal{P}[\bm{s},\bm{x}]$</span>, to obtain the corresponding marginal probability distribution <span>$\mathcal{P}[\bm{x}]$</span>:</p><p class="math-container">\[    \mathcal{P}[\bm{x}] = \int\mathcal{D}[\bm{s}]\ \mathcal{P}[\bm{s},\bm{x}]\,.\]</p><p>Note that in our case, <span>$\bm{s}$</span> and <span>$\bm{x}$</span> are trajectories and that therefore the integral <span>$\int\mathcal{D}[\bm{s}]$</span> is actually a path integral.</p><h2 id="Equivalence-of-Marginalization-Integrals-and-Free-Energy-Computations"><a class="docs-heading-anchor" href="#Equivalence-of-Marginalization-Integrals-and-Free-Energy-Computations">Equivalence of Marginalization Integrals and Free Energy Computations</a><a id="Equivalence-of-Marginalization-Integrals-and-Free-Energy-Computations-1"></a><a class="docs-heading-anchor-permalink" href="#Equivalence-of-Marginalization-Integrals-and-Free-Energy-Computations" title="Permalink"></a></h2><p>In this section we establish the equivalence between computing a marginalization integral and computing the free energy in statistical physics.</p><p>In the language of statistical physics, <span>$\mathcal{P}[\bm{x}]$</span> corresponds to the normalization constant, or partition function, of a Boltzmann distribution for the potential</p><p class="math-container">\[    \mathcal{U}[\bm{s},\bm{x}] = -\ln\mathcal{P}[\bm{s},\bm{x}] \,.\]</p><p>We interpret <span>$\bm{s}$</span> as a variable in the configuration space whereas <span>$\bm{x}$</span> is an auxiliary variable, i.e. a parameter. Note that both <span>$\bm{s}$</span> and <span>$\bm{x}$</span> still represent trajectories. For this potential, the partition function is given by</p><p class="math-container">\[    \mathcal{Z}[\bm{x}] = \int\mathcal{D}[\bm{s}]\; e^{-\mathcal{U}[\bm{s},\bm{x}]} \,.\]</p><p>The integral only runs over the configuration space, i.e. we integrate only with respect to <span>$\bm{s}$</span> but not <span>$\bm{x}$</span>, which remains a parameter of the partition function. The partition function is precisely equal to the marginal probability of the output, i.e. <span>$\mathcal{Z}[\bm{x}] = \mathcal{P}[\bm{x}]$</span>, as can be verified by inserting the expression for the <span>$\mathcal{U}[\bm{s},\bm{x}]$</span>. Further, the free energy is defined as</p><p class="math-container">\[    \mathcal{F}[\bm{x}] = -\ln \mathcal{Z}[\bm{x}] = -\ln \mathcal{P}[\bm{x}]\,,\]</p><p>i.e. the computation of the free energy of the trajectory ensemble corresponding to <span>$\mathcal{U}[\bm{s}, \bm{x}]$</span> is equivalent to the computation of (the logarithm of) the marginal probability <span>$\mathcal{P}[\bm{x}]$</span>.</p><p>Note that above we omitted any factors of <span>$k_{\mathrm{B}}T$</span> that are typically used in physics since temperature is irrelevant here.  Also note that while the distribution <span>$\exp(-\mathcal{U}[\bm{s},\bm{x}])$</span> looks like the equilibrium distribution of a canonical ensemble from statistical mechanics, this does not imply that the we can only study systems in thermal equilibrium. Thus, the notation introduced in this section is nothing else but a mathematical reformulation of the marginalization integral to make the analogy to statistical physics apparent and we assign no additional meaning of the potentials and free energies introduced here.</p><p>In statistical physics it is well known that the free energy cannot be directly measured from a single simulation. Instead, one estimates the free-energy difference</p><p class="math-container">\[    \Delta\mathcal{F}[\bm{x}] = \mathcal{F}[\bm{x}] - \mathcal{F}_0[\bm{x}] = -\ln \frac{\mathcal{Z}[\bm{x}]}{\mathcal{Z}_0[\bm{x}]}\]</p><p>between the system and a reference system with known free energy <span>$\mathcal{F}_0[\bm{x}]$</span>. The reference system is described by the potential <span>$\mathcal{U}_0[\bm{s}, \bm{x}]$</span> with the corresponding partition function <span>$\mathcal{Z}_0[\bm{x}]$</span>.  In our case, a natural choice of reference potential is</p><p class="math-container">\[    \mathcal{U}_0[\bm{s},\bm{x}]=-\ln\mathcal{P}[\bm{s}]\]</p><p>with  the corresponding partition function</p><p class="math-container">\[        \mathcal{Z}_0[\bm{x}]=\int\mathcal{D}[\bm{s}] \mathcal{P}[\bm{s}]=1\,.\]</p><p>This means that since <span>$\mathcal{P}[\bm{s}]$</span> is a normalized probability density function, the reference free energy is zero (<span>$\mathcal{F}_0[\bm{x}]=-\ln\mathcal{Z}_0[\bm{x}]=0$</span>). Hence, for the above choice of reference system, the free-energy difference is</p><p class="math-container">\[    \Delta\mathcal{F}[\bm{x}]= \mathcal{F}[\bm{x}] = -\ln\mathcal{P}[\bm{x}]\,.\]</p><p>Note that in our case the reference potential <span>$\mathcal{U}_0[\bm{s},\bm{x}]=-\ln\mathcal{P}[\bm{s}]$</span> does not depend on the output trajectory <span>$\bm{x}$</span>, i.e. <span>$\mathcal{U}_0[\bm{s},\bm{x}]\equiv\mathcal{U}_0[\bm{s}]$</span>. It describes a <em>non-interacting</em> version of our input-output system where the input trajectories evolve completely independently of the fixed output trajectory <span>$\bm{x}$</span>. </p><p>What is the interaction between the output <span>$\bm{x}$</span> and the input trajectory ensemble? We define the interaction potential <span>$\Delta\mathcal{U}[\bm{s}, \bm{x}]$</span> through</p><p class="math-container">\[    \mathcal{U}[\bm{s}, \bm{x}] = \mathcal{U}_0[\bm{s}] + \Delta\mathcal{U}[\bm{s}, \bm{x}] \,.\]</p><p>The interaction potential makes it apparent that the distribution of <span>$\bm{s}$</span> trajectories corresponding to the potential <span>$\mathcal{U}[\bm{s}, \bm{x}]$</span> is biased by <span>$\bm{x}$</span> with respect to the distribution corresponding to the reference potential <span>$\mathcal{U}_0[\bm{s}]$</span>. By inserting the expressions for <span>$\mathcal{U}_0[\bm{s}]$</span> and <span>$\mathcal{U}[\bm{s}, \bm{x}]$</span> we see that</p><p class="math-container">\[    \Delta\mathcal{U}[\bm{s}, \bm{x}] = -\ln\mathcal{P}[\bm{x}|\bm{s}] \,.\]</p><p>This expression illustrates that the interaction of the output trajectory <span>$\bm{x}$</span> with the ensemble of input trajectories is characterized by the trajectory likelihood <span>$\mathcal{P}[\bm{x}|\bm{s}]$</span>. Since we can compute the trajectory likelihood from the master equation, so can we compute the interaction potential.</p><h2 id="Direct-PWS"><a class="docs-heading-anchor" href="#Direct-PWS">Direct PWS</a><a id="Direct-PWS-1"></a><a class="docs-heading-anchor-permalink" href="#Direct-PWS" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PathWeightSampling.DirectMCEstimate" href="#PathWeightSampling.DirectMCEstimate"><code>PathWeightSampling.DirectMCEstimate</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">DirectMCEstimate(M::Int)</code></pre><p>This is the simplest marginalization strategy, estimating the marginal path probabilities using a direct Monte Carlo simulation.</p><p><code>M</code> specifies the number of samples to be used for the Monte Carlo average. Larger <code>M</code> improves the accuracy of the marginalization integral, but increases the computational cost.</p><p><strong>Mathematical Description</strong></p><p>The marginal probability</p><p class="math-container">\[\mathrm{P}[\bm{x}] = \int\mathrm{d}\bm{s} \mathrm{P}[\bm{x}|\bm{s}] \mathrm{P}[\bm{s}]\]</p><p>can be computed via a Monte Carlo estimate by sampling <code>M</code> trajectories from <span>$\mathrm{P}[\bm{s}]$</span> and taking the average of the likelihoods:</p><p class="math-container">\[\mathrm{P}[\bm{x}] = \langle \mathrm{P}[\bm{x}|\bm{s}] \rangle_{\mathrm{P}[\bm{s}]}\,.\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/manuel-rhdt/PathWeightSampling.jl/blob/af79475e1b488be64d838e938c55d3ce5127e8d7/src/marginal_strategies/DirectMC.jl#L1-L22">source</a></section></article><p>The direct scheme makes it possible to compute the marginal probability <span>$\mathcal{P}[\bm{x}]$</span> for the output trajectory of an externally driven Markov jump process. Yet, due to the combinatorial explosion of possible input trajectories, the variance of the direct scheme increases exponentially with trajectory length. Hence, for complex information processing networks and long trajectories the direct estimate may incur very high computational cost. Therefore, we implemented two improved variants of PWS which allow us to study more complex information processing networks.</p><h2 id="RR-PWS"><a class="docs-heading-anchor" href="#RR-PWS">RR-PWS</a><a id="RR-PWS-1"></a><a class="docs-heading-anchor-permalink" href="#RR-PWS" title="Permalink"></a></h2><p>In Rosenbluth-Rosenbluth PWS (RR-PWS) we compute the free-energy difference <span>$\Delta\mathcal{F}$</span> between the ideal system <span>$\mathcal{U}_0$</span> and <span>$\mathcal{U}$</span> in a <em>single</em> simulation just like with the direct method. However, instead of generating <span>$\bm{s}$</span> trajectories in an uncorrelated fashion according to <span>$\exp(-\mathcal{U}_0[\bm{s}])=\mathcal{P}[\bm{s}]$</span>, we bias our sampling distribution towards <span>$\exp(-\mathcal{U}[\bm{s}, \bm{x}])\propto\mathcal{P}[\bm{s}|\bm{x}]$</span> to reduce the sampling problems found in the <code>DirectMCEstimate</code>.</p><article class="docstring"><header><a class="docstring-binding" id="PathWeightSampling.SMCEstimate" href="#PathWeightSampling.SMCEstimate"><code>PathWeightSampling.SMCEstimate</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SMCEstimate(num_particles::Int)</code></pre><p>Compute the marginal trajectory probability using a Sequential Monte Carlo (SMC) algorithm, more specifically using a <a href="https://en.wikipedia.org/wiki/Particle_filter">particle filter</a>.</p><p>In a particle filter, <code>num_particles</code> trajectories are propagated in parallel. At regular intervals, the current set of parallel trajectories undergoes a resampling step where some of the trajectories get eliminated and others duplicated, depending on their accumulated likelihood. This resampling ensures that we don&#39;t sample trajectories that contribute only  very little to the marginalization integral.</p><p>Due to the periodic resampling of the trajectories, this method works much better than the  <code>DirectMCEstimate</code> for long trajectories.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/manuel-rhdt/PathWeightSampling.jl/blob/af79475e1b488be64d838e938c55d3ce5127e8d7/src/marginal_strategies/SMC.jl#L136-L150">source</a></section></article><h2 id="TI-PWS"><a class="docs-heading-anchor" href="#TI-PWS">TI-PWS</a><a id="TI-PWS-1"></a><a class="docs-heading-anchor-permalink" href="#TI-PWS" title="Permalink"></a></h2><p>The third marginalization scheme is based on the analogy of marginalization integrals with reversible work computations. As before, we view the problem of computing the marginal probability <span>$\mathcal{P}[\bm{x}]$</span> as equivalent to that of computing the free energy between ensembles that are defined by the potentials <span>$\mathcal{U}_0[\bm{s}, \bm{x}]$</span> and <span>$\mathcal{U}[\bm{s}, \bm{x}]$</span>, respectively. For the TI-PWS estimate we additionally assume that there is a continuous parameter that transforms the ensemble from <span>$\mathcal{U}_0$</span> to <span>$\mathcal{U}$</span>.   Mathematically, we thus have a continuous mapping from <span>$\theta\in[0,1]$</span> to a potential <span>$\mathcal{U}_\theta[\bm{s},\bm{x}]$</span> (where <span>$\mathcal{U}=\mathcal{U}_1$</span>) with a corresponding partition function </p><p class="math-container">\[\mathcal{Z}_\theta[\bm{x}]=\int\mathcal{D}[\bm{s}]\ e^{-\mathcal{U}_\theta[\bm{s},\bm{x}]} \,.\]</p><p>For instance, for <span>$0\leq\theta\leq 1$</span>, we can define our potential to be </p><p class="math-container">\[    \mathcal{U}_\theta[\bm{s},\bm{x}]=\mathcal{U}_0[\bm{s}, \bm{x}]+\theta\,\Delta\mathcal{U}[\bm{s},\bm{x}]\,,\]</p><p>such that <span>$e^{-\mathcal{U}_\theta[\bm{s},\bm{x}]}=\mathcal{P}[\bm{s}]\mathcal{P}[\bm{x}|\bm{s}]^\theta$</span>.</p><p>To derive the thermodynamic integration estimate for the free-energy difference, we first compute the derivative of <span>$\ln\mathcal{Z}_\theta[\bm{x}]$</span> with respect to <span>$\theta$</span>:</p><p class="math-container">\[\begin{aligned}
    \frac{\partial}{\partial \theta} \ln\mathcal{Z}_\theta[\bm{x}] &amp;= \frac{1}{\mathcal{Z}_\theta[\bm{x}]} \frac{\partial}{\partial \theta} \int\mathcal{D}[\bm{s}]\  e^{-\mathcal{U}_\theta[\bm{s},\bm{x}]} \\
    &amp;= -\left\langle \frac{\partial \mathcal{U}_\theta[\bm{s},\bm{x}]}{\partial\theta} \right\rangle_\theta\\
    &amp;= -\left\langle
    \Delta\mathcal{U}[\bm{s},\bm{x}]
    \right\rangle_\theta\,.
\end{aligned}\]</p><p>Thus, the derivative of <span>$\ln\mathcal{Z}_\theta[\bm{x}]$</span> is an average of the Boltzmann weight with respect to <span>$\mathcal{P}_\theta[\bm{s}|\bm{x}]$</span> which is the ensemble distribution of <span>$\bm{s}$</span> given by</p><p class="math-container">\[    \mathcal{P}_\theta[\bm{s}|\bm{x}] = \frac{1}{\mathcal{Z}_\theta[\bm{x}]} e^{-\mathcal{U}_\theta[\bm{s}, \bm{x}]}\,.\]</p><p>Integrating with respect to <span>$\theta$</span> leads to the formula for the free-energy difference</p><p class="math-container">\[    \Delta\mathcal{F}[\bm{x}] = -\int^1_0 \mathrm{d}\theta\ \left\langle 
    \Delta\mathcal{U}[\bm{s}, \bm{x}]
    \right\rangle_\theta\]</p><p>which is the fundamental identity underlying thermodynamic integration.</p><article class="docstring"><header><a class="docstring-binding" id="PathWeightSampling.TIEstimate" href="#PathWeightSampling.TIEstimate"><code>PathWeightSampling.TIEstimate</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">TIEstimate(burn_in::Int, integration_nodes::Int, num_samples::Int)</code></pre><p>Compute marginalization integrals using <a href="https://en.wikipedia.org/wiki/Thermodynamic_integration">thermodynamic integration</a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/manuel-rhdt/PathWeightSampling.jl/blob/af79475e1b488be64d838e938c55d3ce5127e8d7/src/marginal_strategies/ThermodynamicIntegration.jl#L4-L8">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/">« Examples</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.8 on <span class="colophon-date" title="Monday 20 December 2021 18:51">Monday 20 December 2021</span>. Using Julia version 1.6.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
